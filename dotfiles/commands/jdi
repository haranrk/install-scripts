#!/usr/bin/env bash
set -euo pipefail

if [[ -z "${JD_ROOT:-}" ]]; then
  echo "JD_ROOT is not set." >&2
  exit 1
fi

if [[ $# -lt 1 ]]; then
  echo "Usage: jdi <pattern>" >&2
  exit 1
fi

pattern=$1

shopt -s nullglob
matches=("${JD_ROOT}"/*/*/"${pattern}"*)
shopt -u nullglob

if (( ${#matches[@]} == 0 )); then
  echo "No Johnny Decimal index matched '${pattern}'." >&2
  exit 1
fi

printf '%s\n' "${matches[0]}"
