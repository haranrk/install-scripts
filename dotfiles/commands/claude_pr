#!/usr/bin/env bash
set -euo pipefail

if ! command -v claude >/dev/null 2>&1; then
  echo "claude CLI is required to update the pull request description." >&2
  exit 1
fi

claude -p "Analyse the diff from the base branch and update the pr description. Use the cmd gh pr view --json baseRefName --jq .baseRefName to find the base branch. If the PR has not been created yet, don't create it. The PR should have the the following sections \n- Summary: 2-3 lines on what the PR does. \n- Changes: Concise bulleted list of changes. If there are a lot of changes, group the bullets into high-level themes. \n\nDo not use emojis or give detailed changes." --allowedTools "Bash(git add:*),Bash(git diff:*),Bash(git commit:*),Bash(gh pr edit:*),Bash(gh pr view:*),Read" --permission-mode acceptEdits
